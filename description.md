# SF-AdTech - сайт площадки интернет-рекламы
**Документация**

## Назначение

Данная система предназначена для размещения и биллинга интернет-рекламы. Она позволяет создавать рекламные кампании, управлять их настройками, , отслеживать статистику и расчитывать затраты.

## Пользователи системы 

В системе предусмотрены три роли пользователей:

- Рекламодатель;
- Web-мастер;
- Администратор.

Ползователь с ролью "Рекламодатель" может:

- добавлять/изменять/деактивировать рекламные предложения (офферы);
- просматривать факты подписки на офферы;
- просматривать отчеты: "Статистика переходов", "Затраты на рекламу"

Ползователь с ролью "Web-мастер" может:

- просматривать список доступных
- подписываться на рекламные предложения (офферы);
- просматривать записи пререходов клиентов по подписанным офферам;
- просматривать отчеты: "Статистика переходов", "Доходы от подписки"

Ползователь с ролью "Администратор" может:

- редактировать профили остальных пользователей, в т.ч. назначать роли и уровень доступа (нет доступа/просмотр/изменение);
- просматривать данные о выставленных офферах и оформленных подписках;
- просматривать отчеты: "Статистика переходов", "Доходы рекламной площадки"

Роли пользователям могут предоставляться следующим образом:

- любой зарегистрированный и авторизованный пользователь может назначить себе роль "Рекламодатель" и/или "Web-мастер" на странице редактирования своего профиля (пункт меню "Профиль");
- Администратор системы может назначать зарегистрированным пользователям любую роль, в том числе роль "Администратор", зайдя в профиль пользователя через пункт меню "Пользователи" и выбрав пользователя в списке.

## Интерфейс системы

Навигация по сайту осуществляется с помощью меню в заголовке страницы. 
Для рекламодателя основной пункт меню - "Предложения", для web-мастера - пункт "Подписки". Описание функций данных пунктов будет дано ниже. Для всех ролей доступны пункты меню "Отчеты", "Пользователи", "Профиль", "Регистрация", "Вход" и "Выход". Пункт "Пользователи" предназначен для администратора сайта. 

**Пункт меню "Предложения"**

При выборе данного пункта меню пользователь попадает на страницу, где отображается список предложений по рекламе (офферов) и их статус (Доступен/Недоступен). Пользователи с ролью "Рекламодатель" увидят только свои офферы в любом статусе (активен/неактивен). Пользователи с ролью "Web-мастер" увидят список всех активных офферов в системе.
На этой странице Рекламодателю доступны следующие функции:

- добавление нового предложения;
- просмотр и изменение своих оффероов, в т.ч. цену за один переход, рекламную ссылку, тему, статус "Доступен/Недоступен";
- просмотр подписок на предложение.

Web-мастера на данной странице может просмотреть список доступных офферов и выбрать те, на которые он хочет оформить подписку (кнопка "Подписаться" на странице просмотра оффера).

**Пункт меню "Подписки"**

Данный пункт меню актуален для Web-мастеров. Он открывает страницу со списком подписок текущего пользователя на офферы рекламодателей. Для каждой подписки Web-мастер может:

- посмотреть параметры подписки;
- удалить подписку;
- скопировать ссылку целевого перехода, для вставки на свой ресурс (клик на ссылке, копирует ее в буфер обмена).

Кроме того, со страницы со списком подписок, можно перейти на страницу для тестирования рекламных ссылок через API-интерфейс 

**Пункт меню "Отчеты"**

Данный пункт открывает страницу с сылками на доступные отчеты. Система позволяет формировать следующие отчеты:

1. Статистика переходов по целевым ссылкам из офферов Рекламодателей (количество запросов ссылки, удачных проверок запросов, подтвержденных переходов);
2. Затраты Рекламодателя на основании подтвержденных переходов по ссылкам;
3. Доход Web-мастера от подписки на офферы;
4. Доход системы.

Во всех отчетах можно указать начало и окончание отчетного периода, тип агрегации сумм (день, месяц, год) и уровень группировки (период, рекламодатель, оффер).
Для отчетов 2,3,4, система кроме табличных данных, отображает график динамики сумм.

**Пункт меню "Пользователи"**

Данный пункт предназначен для Администратора. Он открывает страницу со списком пользователей. Выбрав пользователя из списка Администратор может открыть профиль пользователя.

**Пункт меню "Профиль"**

Данный пункт открывает страницу профиля пользователя. На этой странице пользователь может исправить информацию о себе, изменить пароль, назначить себе роли "Рекламодатель", "Web-мастер". Администратор системы, так же может назначить роль "Администратор" и изменить уровень доступа пользователя. Кроме того, на данной странице пользователь может получить токен для доступа к сайту через интерфейс API (см. далее).

## Подключение ссылок на сайтах web-мастеров для перехода по целевым рекламным адресам . Интерфейс API системы.

Для перехода к целевым рекламируемым ресурсам с сайта Web-мастера используется следующий алгоритм:

1. Web-мастер в страницы своего сайта внедряет ссылку на данный сайт с указанием ID подписки на оффер рекламодателя. При отправки GET-запроса необходима авторизация через токен.
2. При получении запроса от Web-мастера, система, после авторизации, делает запись о переходе в билинговой подсистеме и проверяет валидность и доступность подписки по ID.
3. Если данная подписка не доступна, система перенаправляет запрос на страницу с сообщением об ошибке.
4. Если проверка пройдена успешно, система возвращает ссылку на целевой рекламный ресурс. К целевой ссылке добавляется параметр (?rd=<9999>) с указанием ID записи билинговой системы о переходе.
5. Web-мастер открывает пользователю своего сайта новую страницу с целевым рекламным адресом.
6. На целевой странице, при ее загрузке, Рекламодатель с помощью JavaScript отправляет через API системы (с авторизацией спомощью токена) подтверждение перехода с указанным ID. 

Для реализации вышеизложенного алгоритма, API системы предоставляет два простых маршрута:

1.  /api/go/{id}      - запрос целевого адреса для Web-мастера
2. /api/success/{id}  - подтверждение перехода на страницу Рекламодателя.

В первом маршруте указывается ID подписки Web-мастера на оффер Рекламодателя. Web-мастер может получить свою ссылку на странице просмотра подписки. Пример скрипта запроса можно посмотреть в коде файла test.blade.php
Во втором маршруте указывается ID записи билинговой подсистемы о переходе по целевой ссылке. Рекламодатель получает этот ID из параметра (?rd=<9999>) GET-запроса страницы своего сайта. Пример скрипта запроса можно посмотреть в коде файла redir-index.blade.php

***
**2023@DVSt** [PHP_DEV_27 Final project - SF-AdTech](https://github.com/SotnikovDV/PHP_DEV_27_FINAL.git)